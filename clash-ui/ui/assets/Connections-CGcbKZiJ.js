import{t as e}from"./IconChevronRight-Dj4Dpy4R.js";import{n as t,t as n}from"./IconPlayerPlay-DWxG9t9z.js";import{$t as r,Bt as i,Cn as a,Dn as o,En as s,F as c,Ft as l,In as u,It as d,J as f,L as p,Mn as m,Nn as h,Pn as g,Qt as _,Tn as v,U as y,Vn as b,Vt as x,W as ee,Xt as S,Y as C,Yt as w,Zt as T,_n as E,an as D,at as O,bn as k,bt as A,cn as j,ct as te,d as M,en as ne,gn as N,ht as P,in as F,jn as I,kn as L,ln as R,m as re,nn as ie,on as z,p as B,pn as V,rn as ae,sn as H,st as oe,tn as se,vn as U,vt as W,w as G,xn as K,xt as q,yn as ce,yt as J}from"./index-BZbSGIBZ.js";var Y=j(`outline`,`chevron-left`,`ChevronLeft`,[[`path`,{d:`M15 6l-6 6l6 6`}]]),X=j(`outline`,`chevrons-left`,`ChevronsLeft`,[[`path`,{d:`M11 7l-5 5l5 5`}],[`path`,{d:`M17 7l-5 5l5 5`}]]),le=j(`outline`,`chevrons-right`,`ChevronsRight`,[[`path`,{d:`M7 7l5 5l-5 5`}],[`path`,{d:`M13 7l5 5l-5 5`}]]),ue=j(`outline`,`info-small`,`InfoSmall`,[[`path`,{d:`M12 9h.01`}],[`path`,{d:`M11 12h1v4h1`}]]),de=P(),fe=a(`<div class="flex w-full flex-col gap-2"><div class="flex flex-wrap items-center gap-2"><div class="tabs-box tabs gap-2 tabs-sm"></div><div class="flex items-center gap-2"><span class="hidden text-sm sm:inline-block"></span><input type=checkbox class="toggle toggle-sm"></div><select class="select max-w-40 flex-1 select-sm select-primary"><option value></option></select></div><div class="flex flex-wrap items-center gap-2"><div class="flex shrink-0 items-center gap-1"><span class="hidden text-sm whitespace-nowrap sm:inline-block"></span><select class="select select-sm select-primary"></select></div><div class="join flex min-w-0 flex-1 items-center"><input type=search class="input input-sm join-item min-w-0 flex-1 input-primary">`),pe=a(`<button><span></span><div class="badge badge-sm">`),Z=a(`<option>`),me=a(`<div class="loading loading-spinner">`);let Q=function(e){return e[e.activeConnections=0]=`activeConnections`,e[e.closedConnections=1]=`closedConnections`,e}({});const he=e=>{let[r]=y(),[i,a]=g(!1),o=async()=>{a(!0),e.table.getState().globalFilter?await Promise.allSettled(e.table.getFilteredRowModel().rows.map(({original:e})=>C(e.id))):await f(),a(!1)};return(()=>{var a=fe(),c=a.firstChild,l=c.firstChild,u=l.nextSibling,d=u.firstChild,f=d.nextSibling,p=u.nextSibling,m=p.firstChild,g=c.nextSibling.firstChild,_=g.firstChild,v=_.nextSibling,y=g.nextSibling,b=y.firstChild;return U(l,L(s,{get each(){return e.tabs()},children:t=>(()=>{var n=pe(),r=n.firstChild,i=r.nextSibling;return n.$$click=()=>e.setActiveTab(t().type),U(r,()=>t().name),U(i,()=>t().count),h(()=>N(n,R(e.activeTab()===t().type&&`bg-primary text-neutral!`,`tab gap-2 px-2`))),n})()})),U(d,()=>r(`quickFilter`)),f.addEventListener(`change`,t=>e.setEnableQuickFilter(t.target.checked)),p.addEventListener(`change`,t=>e.setSourceIPFilter(t.target.value)),U(m,()=>r(`all`)),U(p,L(s,{get each(){return(0,de.uniq)(O().map(({metadata:{sourceIP:e}})=>{let t=e||r(`inner`);return W().find(e=>e.sourceIP===t)?.tagName||t})).sort()},children:e=>(()=>{var t=Z();return U(t,e),h(()=>t.value=e()),t})()}),null),U(_,()=>r(`sortBy`)),v.addEventListener(`change`,t=>{let n=t.target.value;e.setSortColumn(n),e.setSorting([{id:n,desc:e.sortDesc()}])}),U(v,L(s,{get each(){return e.sortables()},children:e=>(()=>{var t=Z();return U(t,()=>r(e().key)),h(()=>t.value=e().id),t})()})),U(g,L(w,{class:`btn btn-sm btn-primary`,onClick:()=>{let t=!e.sortDesc();e.setSortDesc(t),e.setSorting([{id:e.sortColumn(),desc:t}])},get icon(){return k(()=>!!e.sortDesc())()?L(D,{}):L(z,{})}}),null),b.$$input=t=>e.setGlobalFilter(t.target.value),U(y,L(w,{class:`btn join-item btn-sm btn-primary`,onClick:()=>e.setPaused(e=>!e),get icon(){return k(()=>!!e.paused())()?L(n,{}):L(t,{})}}),null),U(y,L(w,{class:`btn join-item btn-sm btn-primary`,onClick:o,get icon(){return k(()=>!!i())()?me():L(F,{})}}),null),U(y,L(w,{class:`btn join-item btn-sm btn-primary`,get onClick(){return e.onOpenSettings},get icon(){return L(H,{})}}),null),h(()=>K(b,`placeholder`,r(`search`))),h(()=>f.checked=e.enableQuickFilter()),h(()=>v.value=e.sortColumn()),a})()};E([`input`,`click`]);const ge=async e=>{typeof e==`string`?await navigator.clipboard.writeText(e):await navigator.clipboard.write(e)};var _e=a(`<div class="flex-1 overflow-x-auto rounded-md bg-base-300">`);const ve=e=>{let[t]=y(),n=(e,t)=>{t.preventDefault();let n=e.renderValue();n&&ge(n).catch(()=>{})},r=e=>{let n=e.column.columnDef.meta?.headerKey;return n?t(n):``};return(()=>{var t=_e();return U(t,L(S,{get table(){return e.table},get size(){return q()},pinRows:!0,rowHover:!0,zebra:!0,hideHeaderOnMobile:!0,rowClass:`even:bg-base-500 flex flex-wrap rounded-xl border-4 border-base-300 px-2 odd:bg-base-100 md:table-row md:rounded-none md:border-0 md:px-0`,cellClass:`w-1/2 min-w-[50%] pb-1.5 text-justify align-top wrap-break-word nth-[2n]:text-right nth-last-[2]:mb-3 sm:w-1/3 sm:min-w-[33.333%] sm:nth-[2n]:text-justify sm:nth-[3n]:text-right md:w-auto md:min-w-0 md:text-start md:align-middle md:whitespace-nowrap md:nth-[2n]:text-start md:nth-[3n]:text-start md:nth-last-[2]:mb-0`,onCellContextMenu:n,renderMobileLabel:r})),t})()};var ye=a(`<div class="join shrink-0"><button class="btn join-item btn-xs"></button><button class="btn join-item btn-xs"></button><button class="btn join-item btn-xs"></button><button class="btn join-item btn-xs">`),be=a(`<span class="flex items-center px-1 text-xs text-base-content/40">···`),xe=a(`<button>`),Se=a(`<div class="flex shrink-0 items-center justify-center md:hidden">`),Ce=a(`<div class="hidden shrink-0 items-center justify-between gap-2 md:flex"><div class="flex shrink-0 items-center gap-1.5"><select class="select-bordered select select-xs"></select><span class="text-xs whitespace-nowrap text-base-content/60">-<span class=text-base-content/40> / `),we=a(`<option>`),Te=t=>(()=>{var n=ye(),r=n.firstChild,i=r.nextSibling,a=i.nextSibling,s=a.nextSibling;return r.$$click=()=>t.table.setPageIndex(0),U(r,L(X,{size:14})),i.$$click=()=>t.table.previousPage(),U(i,L(Y,{size:14})),U(n,L(v,{get each(){return t.visiblePages()},children:(e,n)=>[L(o,{get when(){return k(()=>n()>0)()&&e-t.visiblePages()[n()-1]>1},get children(){return be()}}),(()=>{var n=xe();return n.$$click=()=>t.table.setPageIndex(e),U(n,e+1),h(()=>N(n,R(`btn join-item min-w-8 btn-xs`,t.table.getState().pagination.pageIndex===e&&`btn-active`))),n})()]}),a),a.$$click=()=>t.table.nextPage(),U(a,L(e,{size:14})),s.$$click=()=>t.table.setPageIndex(t.table.getPageCount()-1),U(s,L(le,{size:14})),h(e=>{var n=!t.table.getCanPreviousPage(),o=!t.table.getCanPreviousPage(),c=!t.table.getCanNextPage(),l=!t.table.getCanNextPage();return n!==e.e&&(r.disabled=e.e=n),o!==e.t&&(i.disabled=e.t=o),c!==e.a&&(a.disabled=e.a=c),l!==e.o&&(s.disabled=e.o=l),e},{e:void 0,t:void 0,a:void 0,o:void 0}),n})();const Ee=e=>(()=>{var t=Se();return U(t,L(Te,{get table(){return e.table},get visiblePages(){return e.visiblePages}})),t})(),De=e=>(()=>{var t=Ce(),n=t.firstChild.firstChild,r=n.nextSibling,i=r.firstChild,a=i.nextSibling;return a.firstChild,n.addEventListener(`change`,t=>e.setPageSize(Number(t.target.value))),U(n,L(v,{each:[20,50,100,200],children:e=>(()=>{var t=we();return t.value=e,U(t,e),t})()})),U(r,()=>e.table.getState().pagination.pageIndex*e.table.getState().pagination.pageSize+1,i),U(r,()=>Math.min((e.table.getState().pagination.pageIndex+1)*e.table.getState().pagination.pageSize,e.table.getFilteredRowModel().rows.length),a),U(a,()=>e.table.getFilteredRowModel().rows.length,null),U(t,L(Te,{get table(){return e.table},get visiblePages(){return e.visiblePages}}),null),h(()=>n.value=e.pageSize()),t})();E([`click`]);var Oe=b(V(),1),$=a(`<div class="flex items-center">`),ke=a(`<span class=align-middle>`);const Ae=t=>{let[n]=y(),{activeConnections:a,closedConnections:s,paused:l,setPaused:d}=te(),[f,h]=g(Q.activeConnections),[b,S]=g(``),[E,D]=i(g(!1),{name:`enableQuickFilter`,storage:localStorage}),[O,k]=g([]),[j,M]=i(g([{id:x.ConnectTime,desc:!0}]),{name:`connectionsTableSorting`,storage:localStorage}),[N,P]=i(g(50),{name:`connectionsTablePageSize`,storage:localStorage}),R=m(()=>{let e=(f()===Q.activeConnections?a():s()).slice().sort((e,t)=>e.id.localeCompare(t.id));if(!E())return e;try{let t=new RegExp(oe(),`i`);return e.filter(e=>!t.test(e.chains.join(``)))}catch{return e}}),re=[{meta:{headerKey:`details`},header:()=>n(`details`),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:x.Details,cell:({row:e})=>(()=>{var n=$();return U(n,L(w,{class:`btn-circle btn-xs`,onClick:()=>t.onShowDetails(e.original.id),get icon(){return L(ue,{size:`16`})}})),n})()},{meta:{headerKey:`close`},header:()=>n(`close`),enableGrouping:!1,enableSorting:!1,enableColumnFilter:!1,enableGlobalFilter:!1,accessorKey:x.Close,cell:({row:e})=>(()=>{var t=$();return U(t,L(w,{class:`btn-circle btn-xs`,onClick:()=>C(e.original.id),get icon(){return L(F,{size:`16`})}})),t})()},{meta:{headerKey:`ID`},header:()=>n(`ID`),enableGrouping:!1,accessorKey:x.ID,accessorFn:e=>e.id},{meta:{headerKey:`type`},header:()=>n(`type`),accessorKey:x.Type,accessorFn:e=>`${e.metadata.type}(${e.metadata.network})`},{meta:{headerKey:`process`},header:()=>n(`process`),accessorKey:x.Process,accessorFn:e=>e.metadata.process||e.metadata.processPath.replace(/^.*[/\\](.*)$/,`$1`)||`-`},{meta:{headerKey:`host`},header:()=>n(`host`),accessorKey:x.Host,accessorFn:e=>`${e.metadata.host?e.metadata.host:ee(e.metadata.destinationIP)}:${e.metadata.destinationPort}`},{meta:{headerKey:`sniffHost`},header:()=>n(`sniffHost`),accessorKey:x.SniffHost,accessorFn:e=>e.metadata.sniffHost||`-`},{meta:{headerKey:`rule`},header:()=>n(`rule`),accessorKey:x.Rule,accessorFn:e=>e.rulePayload?`${e.rule} : ${e.rulePayload}`:e.rule},{meta:{headerKey:`chains`},header:()=>n(`chains`),accessorKey:x.Chains,cell:({row:t})=>L(v,{get each(){return t.original.chains.slice().reverse()},children:(t,n)=>[L(o,{get when(){return n()},get children(){return L(e,{class:`inline-block`,size:18})}}),(()=>{var e=ke();return U(e,t),e})()]})},{meta:{headerKey:`connectTime`},header:()=>n(`connectTime`),enableGrouping:!1,accessorKey:x.ConnectTime,accessorFn:e=>c(e.start),sortingFn:(e,t)=>(0,Oe.default)(e.original.start).valueOf()-(0,Oe.default)(t.original.start).valueOf()},{meta:{headerKey:`dlSpeed`},header:()=>n(`dlSpeed`),enableGrouping:!1,accessorKey:x.DlSpeed,accessorFn:e=>`${G(e.downloadSpeed)}/s`,sortingFn:(e,t)=>e.original.downloadSpeed-t.original.downloadSpeed},{meta:{headerKey:`ulSpeed`},header:()=>n(`ulSpeed`),enableGrouping:!1,accessorKey:x.UlSpeed,accessorFn:e=>`${G(e.uploadSpeed)}/s`,sortingFn:(e,t)=>e.original.uploadSpeed-t.original.uploadSpeed},{meta:{headerKey:`dl`},header:()=>n(`dl`),enableGrouping:!1,accessorKey:x.Download,accessorFn:e=>G(e.download),sortingFn:(e,t)=>e.original.download-t.original.download},{meta:{headerKey:`ul`},header:()=>n(`ul`),enableGrouping:!1,accessorKey:x.Upload,accessorFn:e=>G(e.upload),sortingFn:(e,t)=>e.original.upload-t.original.upload},{meta:{headerKey:`sourceIP`},header:()=>n(`sourceIP`),accessorKey:x.SourceIP,accessorFn:e=>{let t=e.metadata.sourceIP||n(`inner`);return W().find(e=>e.sourceIP===t)?.tagName||t}},{meta:{headerKey:`sourcePort`},header:()=>n(`sourcePort`),accessorKey:x.SourcePort,accessorFn:e=>e.metadata.sourcePort},{meta:{headerKey:`destination`},header:()=>n(`destination`),accessorKey:x.Destination,accessorFn:e=>e.metadata.remoteDestination||e.metadata.destinationIP||e.metadata.host},{meta:{headerKey:`inboundUser`},header:()=>n(`inboundUser`),accessorKey:x.InboundUser,accessorFn:e=>e.metadata.inboundUser||e.metadata.inboundName||e.metadata.inboundPort}],z=T({filterFns:{fuzzy:p},state:{get columnOrder(){return J()},get grouping(){return O()},get sorting(){return j()},get columnVisibility(){return A()},get globalFilter(){return b()}},get data(){return R()},sortDescFirst:!0,enableHiding:!0,columns:re,onGlobalFilterChange:S,globalFilterFn:p,onGroupingChange:k,onSortingChange:M,getFilteredRowModel:ne(),getSortedRowModel:ae(),getExpandedRowModel:r(),getGroupedRowModel:se(),getCoreRowModel:_(),getPaginationRowModel:ie(),initialState:{pagination:{pageSize:N()}}});I(()=>{z.setPageSize(N())});let[B,V]=g(j()[0]?.id||x.ConnectTime),[H,K]=g(j()[0]?.desc??!0);I(u(j,()=>{let e=j();e.length&&(V(e[0].id),K(!!e[0].desc))}));let q=m(()=>z.getAllLeafColumns().filter(e=>e.getCanSort()).map(e=>({id:e.id,key:e.columnDef.meta?.headerKey})).filter(e=>!!e.key)),ce=z.getFlatHeaders().find(({id:e})=>e===x.SourceIP),[Y,X]=g(``);return I(u(Y,()=>{let e=W().find(e=>e.sourceIP===Y());ce?.column.setFilterValue(e?e.tagName:Y())})),{table:z,activeTab:f,setActiveTab:h,tabs:m(()=>[{type:Q.activeConnections,name:n(`active`),count:a().length},{type:Q.closedConnections,name:n(`closed`),count:s().length}]),enableQuickFilter:E,setEnableQuickFilter:D,globalFilter:b,setGlobalFilter:S,sourceIPFilter:Y,setSourceIPFilter:X,sorting:j,setSorting:M,sortColumn:B,setSortColumn:V,sortDesc:H,setSortDesc:K,sortables:q,pageSize:N,setPageSize:P,visiblePages:m(()=>{let e=z.getState().pagination.pageIndex,t=z.getPageCount(),n=[];n.push(0);for(let r=Math.max(1,e-1);r<=Math.min(t-2,e+1);r++)n.includes(r)||n.push(r);return t>1&&!n.includes(t-1)&&n.push(t-1),n.sort((e,t)=>e-t)}),paused:l,setPaused:d}};var je=a(`<div class="flex h-full flex-col gap-2">`),Me=()=>{let[e]=y(),t,n,[r,i]=g(),{table:a,activeTab:o,setActiveTab:s,tabs:c,enableQuickFilter:u,setEnableQuickFilter:f,setGlobalFilter:p,setSourceIPFilter:m,setSorting:h,sortColumn:_,setSortColumn:v,sortDesc:b,setSortDesc:x,sortables:ee,pageSize:S,setPageSize:C,visiblePages:w,paused:T,setPaused:E}=Ae({onShowDetails:e=>{i(e),n?.showModal()}});return[L(M,{get children(){return e(`connections`)}}),(()=>{var e=je();return U(e,L(he,{tabs:c,activeTab:o,setActiveTab:s,enableQuickFilter:u,setEnableQuickFilter:f,setSourceIPFilter:m,sortColumn:_,setSortColumn:v,sortDesc:b,setSortDesc:x,setSorting:h,sortables:ee,setGlobalFilter:p,paused:T,setPaused:E,table:a,onOpenSettings:()=>t?.showModal()}),null),U(e,L(Ee,{table:a,visiblePages:w}),null),U(e,L(ve,{table:a}),null),U(e,L(De,{table:a,visiblePages:w,pageSize:S,setPageSize:C}),null),U(e,L(re,{ref:e=>t=e,get order(){return J()},get visible(){return A()},onOrderChange:e=>l(e),onVisibleChange:e=>d({...e})}),null),U(e,L(B,{ref:e=>n=e,get selectedConnectionID(){return r()}}),null),e})()]};export{Me as default};